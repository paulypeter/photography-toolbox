<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<header>
    <nav>
    <div class=nav>
        <a id=nav_toggle onclick="open_nav()"><i class="fa fa-bars menu" aria-hidden="true"></i></a>
        <div class=menu></div>
        <a href="index.html"><i class="fa fa-camera menu" id=title data-lang-str="title"> Photography Toolbox</i></a>
        <a href="docs/calculations.html" target="_blank" class=helplink><i class="fa fa-question menu"></i></a>
        <select id=language onchange="set_language(this.value); apply_language(this.value);"></select>
    </div>
    </nav>
</header>
<link rel=stylesheet href=static/style.css type=text/css>
<script src="src/crop-factor.js"></script>
<script src="src/exposure.js"></script>
<script src="js/lang.js"></script>
<script src="js/Tools.js"></script>

<script src="https://use.fontawesome.com/f35383e121.js"></script>

<title>Priority modes | Photography Toolbox</title>
<div class=sidebar id=sidebar>
    Sidebar-Content
</div>

<div id=content>
<div class=form-container>
    <div class=row data-lang-str="priority">Priority</div>
    <div onchange="toggle_input(); update_result()" class=row>
        <input type="radio" name=setting_choice id=set_shutter_speed value="shutter">
        <label for=set_shutter_speed data-lang-str="shutter">Shutter</label>
        <input type="radio" name=setting_choice id=set_f_stop value="f_stop">
        <label for=set_f_stop data-lang-str="f_stop">F-Stop</label>
    </div>
</div>
<div class=form-container>
    <div class=row data-lang-str="settings">Settings:</div>
    <div class=row>
        <div class=column><label for="iso_speed">ISO</label></div>
        <div class=column><select id="iso_speed" onchange="update_result()"></select></div>
    </div>
    <div class=row id=f_stop_select>
        <div class=column><label for="f_stop" data-lang-str="f_stop">F-stop</label></div>
        <div class=column><select id="f_stop" onchange="update_result()"></select></div>
    </div>
    <div class=row id=shutter_select>
        <div class=column><label for="shutter" data-lang-str="shutter">Shutter speed</label></div>
        <div class=column><select id="shutter" onchange="update_result()"></select></div>
    </div>
    <div class=row>
        <div class=column><label for=ev><span data-lang-str="EV">EV</span>: <span id=ev_input class=input></span></label></div>
        <input type="range" id=ev min=-6 max=21 step=1 value=12 onchange="update_input(); update_result()">
    </div>
</div>
<div class=form-container>
    <div class=row>
        <strong>
        <div class=column data-lang-str="result">result:</div>
        <div class=column>
            <span id=result_prefix></span>
            <span id=result></span>
            <span id=result_unit></span>
        </div>
        </strong>
    </div>
</div>
</div>  <!-- content -->

<script>
    speed_select("f_stop", F_STOPS.reverse())
    speed_select("shutter", SHUTTER_SPEEDS)
    speed_select("iso_speed", ISO_SPEEDS)

    let input_setting = ""
    window.onload = () => {
        document.getElementById("set_shutter_speed").checked = true
        document.getElementById("f_stop_select").style.display = "none"
        update_input()
        update_result()
        current_lang = get_language()
        if (current_lang == null) {
            set_language("en")
        }
        language_select("language", current_lang)
        document.getElementById("result_prefix").innerHTML = "f/"
        let window_width = window.innerWidth;
        if (window_width < 340) {
            document.getElementById("title").innerHTML = " Photo Tools"
        }
        init_nav(current_lang)
        apply_language(current_lang)
    }

    toggle_input = () => {
        let options = document.getElementsByName("setting_choice")
        options.forEach(element => {
            if (element.checked) {
                input_setting = element.value
                document.getElementById(element.value + "_select").style.display = "block"
            } else {
                document.getElementById(element.value + "_select").style.display = "none"
            }
        });
        document.getElementById("result_unit").innerHTML = input_setting == "shutter" ? "" : " s"
        document.getElementById("result_prefix").innerHTML = input_setting == "shutter" ? "f/" : ""
    }

    update_input = () => {
        document.getElementById("ev_input").innerHTML = document.getElementById("ev").value
    }

    update_result = () => {
        let iso_speed = parseInt(document.getElementById("iso_speed").value)
        let ev = parseInt(document.getElementById("ev").value)
        let res = ""
        if (document.getElementById("set_shutter_speed").checked) {
            shutter_speed = get_float_from_speed_str(document.getElementById("shutter").value)
            res = f_stop_for_ev(ev, shutter_speed, iso_speed)
            res_ev = Math.round(
                exposure_value(get_float_from_speed_str(res), shutter_speed, iso_speed)
            )
        } else {
            f_stop = get_float_from_speed_str(document.getElementById("f_stop").value)
            res = shutter_for_ev(ev, f_stop, iso_speed)
            res_ev = Math.round(
                exposure_value(f_stop, get_float_from_speed_str(res), iso_speed)
            )
        }
        document.getElementById("result").innerHTML = res
        document.getElementById("result").style.color = (ev != res_ev) ? "red" : "inherit"
    }
</script>