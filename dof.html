<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<header>
    <nav>
    <div class=nav>
        <a id=nav_toggle onclick="open_nav()"><i class="fa fa-bars menu" aria-hidden="true"></i></a>
        <div class=menu></div>
        <a href="index.html"><i class="fa fa-camera menu" id=titled data-lang-str="title"> Photography Toolbox</i></a>
        <a href="docs/calculations.html" target="_blank" class=helplink><i class="fa fa-question menu"></i></a>
    </div>
    </nav>
</header>
<link rel=stylesheet href=static/style.css type=text/css>
<script src="src/crop-factor.js"></script>
<script src="src/exposure.js"></script>
<script src="js/lang.js"></script>
<script src="js/Tools.js"></script>

<script src="https://use.fontawesome.com/f35383e121.js"></script>

<title>Depth of Field | Photography Toolbox</title>
<div class=sidebar id=sidebar>
    Sidebar-Content
</div>

<div id=content>

<div class=form-container>
    <div class=row>
        <div class=column><label for="sensor" data-lang-str="sensor">Sensor format</label></div>
        <div class=column><select id="sensor" onchange="update_result()"></select></div>
    </div>
    <div class=row>
        <div class=column><label for=focal_length data-lang-str="focal_length">Focal length</label></div>
        <div class=column><input type="number" id=focal_length onchange="update_result()" value=50></div>
    </div>
    <div class=row>
        <div class=column><label for="f_stop" data-lang-str="f_stop">F-stop</label></div>
        <div class=column><select id="f_stop" onchange="update_result()"></select></div>
    </div>
    <div class=row>
        <div class=column><label for=distance data-lang-str="distance">Distance</label></div>
        <div class=column><span id=input class=input></span>
            <select id="distance_unit" onchange="update_result()">
                <option value=10>cm</option>
                <option value=100 selected>dm</option>
                <option value=1000>m</option>
            </select></div>
    </div>
    <div class=row>
        <input type="range" id=distance onchange="update_input(); update_result()" min=1>
    </div>
    <div class=row>
        <input type="checkbox" id=use_custom_coc name=use_custom_coc value=use_custom_coc onchange="toggle_coc(this.checked); update_result()">
        <label for=use_custom_coc data-lang-str="use_custom_coc">Use custom Circle of Confusion calculation</label>
    </div>
</div>
<div class=form-container id=custom_coc_config>
    <div class=row>
        <div class=column><label for=viewing_dist data-lang-str="view_distance">View distance</label></div>
        <div class=column><input type="number" id=viewing_dist value=25 onchange="update_result()"> cm</div>
    </div>
    <div class=row>
        <div class=column><label for=lpmm data-lang-str="lpmm">line pairs / mm:</label></div>
        <div class=column><input type="number" id=lpmm value=5 onchange="update_result()"></div>
    </div>
    <div class=row>
        <div class=column><label for=enlargement data-lang-str="enlargement">Enlargement:</label></div>
        <div class=column><input type="number" id=enlargement value=8 onchange="update_result()"></div>
    </div>
</div>
<div class=form-container>
    <div class=row>
        <strong>
        <div class=column data-lang-str="hyperfocal">Hyperfocal</div><div class=column><span id=hyperfocal_dist></span> m</div>
        </strong>
    </div>
</div>
<div class=form-container>
    <div class=row>
        <strong>
        <div class=column data-lang-str="near_limit">Near limit</div><div class=column><span id=near_limit></span> m</div>
        </strong>
    </div>
    <div class=row>
        <strong>
        <div class=column data-lang-str="far_limit">Far limit</div><div class=column><span id=far_limit></span> m</div>
        </strong>
    </div>
    <div class=row>
        <strong>
        <div class=column data-lang-str="dof">DOF</div><div class=column><span id=dof></span> m</div>
        </strong>
    </div>
</div>
</div>  <!-- content -->

<script>
    sensors_size_select("sensor")
    speed_select("f_stop", F_STOPS.reverse())
    update_input = () => {
        document.getElementById("input").innerHTML = document.getElementById("distance").value
    }
    update_result = () => {
        let focal_length = document.getElementById("focal_length").value
        let sensor_size = JSON.parse(document.getElementById("sensor").value)
        let f_stop = parseFloat(document.getElementById("f_stop").value)
        let distance = (
            parseInt(document.getElementById("distance").value) *
            parseInt(document.getElementById("distance_unit").value)
        )
        let coc_to_use = coc(sensor_size)
        if (document.getElementById("use_custom_coc").checked) {
            let viewing_dist = document.getElementById("viewing_dist").value
            let lpmm = document.getElementById("lpmm").value
            let enlargement = document.getElementById("enlargement").value
            coc_to_use = coc_custom(viewing_dist, lpmm, enlargement)
        }
        dof_far_result = dof_far(distance, focal_length, f_stop, coc_to_use)
        dof_far_result = (dof_far_result < 0) ? Infinity : dof_far_result
        dof_near_result = dof_near(distance, focal_length, f_stop, coc_to_use)
        dof = Number((dof_far_result - dof_near_result).toFixed(2))
        hyperfocal_dist = Number((hyperfocal(focal_length, f_stop, coc_to_use) / 1000).toFixed(2))
        document.getElementById("near_limit").innerHTML = dof_near_result
        document.getElementById("far_limit").innerHTML = dof_far_result
        document.getElementById("hyperfocal_dist").innerHTML = hyperfocal_dist
        document.getElementById("dof").innerHTML = dof
    }

    toggle_coc = (b_use_custom_coc) => {
        document.getElementById("custom_coc_config").style.display = (
            b_use_custom_coc ? "block" : "none"
        )
    }

    window.onload = () => {
        update_input()
        update_result()
        current_lang = get_language()
        if (current_lang == null) {
            set_language("en")
        }
        let window_width = window.innerWidth;
        if (window_width < 340) {
            document.getElementById("title").innerHTML = " Photo Tools"
        }
        document.getElementById("custom_coc_config").style.display = "none"
        apply_language("de")
        init_nav()
        apply_language(current_lang)
    }
</script>